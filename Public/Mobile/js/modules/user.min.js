define(function(require,exports,module){var utils=require('utils');exports.init=function(page,data){if(page=='thanks'){$('#tab-month a').attr('href','index.php/thanks?timetype=month&holetype='+data['holetype']+'&year='+new Date().getFullYear()+'&month='+(new Date().getMonth()+1));$('#tab-year a').attr('href','index.php/thanks?timetype=year&year='+new Date().getFullYear());$('#tab-all a').attr('href','index.php/thanks?timetype=all');$('#select-year').change(function(){var year=$(this).val();location.href=utils.base_url()+'/index.php/thanks?timetype='+data['timetype']+'&holetype='+data['holetype']+'&year='+year+'&month='+data['month'];});$('#select-month').change(function(){var month=$(this).val();location.href=utils.base_url()+'/index.php/thanks?timetype='+data['timetype']+'&holetype='+data['holetype']+'&year='+data['year']+'&month='+month;});$('#select-type').val(data['holetype']);$('#select-type').change(function(){var type=$(this).val();location.href=utils.base_url()+'/index.php/thanks?timetype='+data['timetype']+'&holetype='+type+'&year='+data['year']+'&month='+data['month'];});}else if(page=='public'){$('.grouptabs_item').click(function(){$('.grouptabs_item').removeClass('grouptabs_item-active');$(this).addClass('grouptabs_item-active');var name=$(this).attr('name');$('.records_list').hide();$('#'+name).show();});}else if(page=='coin'){$('.select-type').click(function(){var type=$(this).attr('value');location.href=utils.base_url()+'/index.php/user/coin?type='+type+'&month='+data['month'];});$('.select-month').click(function(){var month=$(this).attr('value');location.href=utils.base_url()+'/index.php/user/coin?type='+data['type']+'&month='+month;});}else if(page=='report'){$('.select-status').click(function(){var status=$(this).attr('value'),search=$.trim($('#report-search').val());location.href=utils.base_url()+'/index.php/user/report?status='+status+'&search='+search;});utils.search_box_bind('report-search','report-search-btn',utils.base_url()+'/index.php/user/report?status='+data['status']+'&search={keyword}');}else if(page=='prize'){$('.select-type').click(function(){var type=$(this).attr('value'),search=$.trim($('#prize-search').val());location.href=utils.base_url()+'/index.php/user/prize?type='+type+'&search='+search;});utils.search_box_bind('prize-search','prize-search-btn',utils.base_url()+'/index.php/user/prize?type='+data['type']+'&search={keyword}');}else if(page=='message'){$('.select-type').click(function(){var type=$(this).attr('value');location.href=utils.base_url()+'/index.php/user/message?type='+type;});$('#message-list .content_title').on('click',function(){var parent=$(this).parent().parent(),mid=$(this).attr('mid'),url='index.php/user/message_read/'+mid;utils.get(url,function(json){if(json.ret==0){$('.mod-popup-message').addClass('mod-popup-show');$('.mod-popup-message .content_title').text(json.data.mtitle);$('.mod-popup-message .content_text').eq(0).html(json.data.mcontent);$('.mod-popup-message .content_time').text(json.data.mtime);parent.removeClass('list_item-new');var message_num=parseInt($('.i-user-message').text())-1;if(message_num<=0){$('.i-user-message').hide();}else{$('.i-user-message').text(message_num);}}else{utils.alert(json.msg,-1);}});});$('.mod-popup-message .i-close').click(function(){$('.mod-popup-message').removeClass('mod-popup-show');});}else if(page=='info'){$('.mod-address-add').click(function(){$('.mod-popup-address .content_title').text('新增收货地址');$('.mod-popup-address input[type=text]').val('');$('.mod-popup-address textarea').val('');$('.mod-popup-address').addClass('mod-popup-show');if($('#address-select .mod-address-added-default').length>0){$('#is_default').prop('checked',false);}else{$('#is_default').prop('checked',true);}});$('.i-address-modify').on('click',function(event){var parent=$(this).parent().parent(),classname=parent.attr('class'),aid=parent.attr('aid'),is_default=classname.indexOf('mod-address-added-default')>=0?true:false,truename=parent.find('.acceptor_name').text(),phone=parent.find('.acceptor_phone').text(),address=parent.find('.address_detail').text();$('.mod-popup-address .content_title').text('修改收货地址');$('#address-id').val(aid);$('#truename').val(truename);$('#phone').val(phone);$('#address').val(address);$('#is_default').prop('checked',is_default);$('.mod-popup-address').addClass('mod-popup-show');});$('.mod-popup .i-close').click(function(){$('.mod-popup-address').removeClass('mod-popup-show');});$('.mod-btn-close').click(function(){$('.mod-popup-address').removeClass('mod-popup-show');});$('.mod-popup-address .mod-btn-blue').click(function(){var config=[{id:'truename',name:'收件人',minlen:1,maxlen:15,etype:'input_text',required:true},{id:'phone',name:'手机号码',minlen:11,maxlen:11,etype:'input_text',dtype:'valid_mobile',required:true},{id:'address',name:'详细地址',minlen:1,maxlen:30,etype:'input_text',required:true}];var data=utils.form_check($('#addr-error'),config);if(!data){$('#addr-error').parent().show();return;}
var aid=parseInt($('#address-id').val()),is_default=$('#is_default').attr('checked')?1:0;if(aid){data['aid']=aid;}
data['is_default']=is_default;utils.post('index.php/user/address_save',data,function(json){if(json.ret==0){location.reload();}else{utils.show_error_tip(json.msg,'addr-error');$('#addr-error').parent().show();}});});}else if(page=='setting'){if(data['birth_year']){$('#birth-year').html('<option value="'+data['birth_year']+'" disabled="disabled" selected="selected" style="display:none;">'+data['birth_year']+'年</option>');$('#birth-month').html('<option value="'+data['birth_month']+'" disabled="disabled" selected="selected" style="display:none;">'+data['birth_month']+'月</option>');$('#birth-day').html('<option value="'+data['birth_day']+'" disabled="disabled" selected="selected" style="display:none;">'+data['birth_day']+'日</option>');}else{utils.set_time_select($('#birth-year'),$('#birth-month'),$('#birth-day'),1950);$('#birth-year').val(0);$('#birth-month').val(0);$('#birth-day').val(0);}
if(data['birth_year']){$('#birth-year').click(function(){utils.alert('您已经填写过生日啦，不可以再更改哦',-1);});$('#birth-month').click(function(){utils.alert('您已经填写过生日啦，不可以再更改哦',-1);});$('#birth-day').click(function(){utils.alert('您已经填写过生日啦，不可以再更改哦',-1);});}
utils.radio_bind('gender');utils.radio_bind('use_realname');utils.input_bind('nickname','昵称',1,25,'');utils.input_bind('real_name','真实姓名',1,25,'');utils.input_bind('email','电子邮箱',1,50,'valid_email');utils.input_bind('phone','移动电话',11,11,'valid_mobile');utils.input_bind('team_name','团队',1,30,'');utils.input_bind('web_host','个人主页',1,40,'valid_url');utils.input_bind('wechat','微信',1,30,'');utils.input_bind('qq','QQ号码',1,25,'numeric');utils.input_bind('people_sign','个性签名',1,100,'');$('#setting-btn').click(function(){var config=[{id:'nickname',name:'昵称',minlen:1,maxlen:25,etype:'input_text',required:true},{id:'real_name',name:'真实姓名',minlen:1,maxlen:25,etype:'input_text'},{id:'email',name:'电子邮箱',minlen:1,maxlen:50,etype:'input_text',dtype:'valid_email'},{id:'phone',name:'移动电话',minlen:11,maxlen:11,etype:'input_text',dtype:'valid_mobile'},{id:'team_name',name:'团队',minlen:1,maxlen:30,etype:'input_text'},{id:'web_host',name:'个人主页',minlen:1,maxlen:40,etype:'input_text',dtype:'valid_url'},{id:'wechat',name:'微信',minlen:1,maxlen:30,etype:'input_text'},{id:'qq',name:'QQ号码',minlen:1,maxlen:25,etype:'input_text',dtype:'numeric'},{id:'tshirt_size',name:'衣服尺码',minlen:1,maxlen:1,etype:'select',dtype:'numeric'},{id:'tshirt_color',name:'衣服颜色',minlen:1,maxlen:5,etype:'select'},{id:'people_sign',name:'个性签名',minlen:1,maxlen:100,etype:'input_text'}];var postdata=utils.form_check($('#setting-error'),config);if(!postdata){$('#setting-error').parent().show();return;}
postdata['figureurl']=$('#figureurl').val();postdata['figureurl_1']=$('#figureurl_1').val();postdata['figureurl_2']=$('#figureurl_2').val();postdata['gender']=utils.radio_value('gender');postdata['use_realname']=utils.radio_value('use_realname');postdata['birth_year']=$('#birth-year').val();postdata['birth_month']=$('#birth-month').val();postdata['birth_day']=$('#birth-day').val();$('#setting-btn').text('保存中...');utils.post('index.php/user/info_save',postdata,function(json){if(json.ret==0){utils.alert('您的个人资料保存成功',1);}else{utils.show_error_tip(json.msg,'setting-error');$('#setting-error').parent().show();}},function(){$('#setting-btn').text('保存提交');});});}else if(page=='bankcard'){}
if(page=='coin'||page=='report'||page=='prize'||page=='message'){utils.set_pagination('pc-pagination');}
$('.footer-home').hide();};});