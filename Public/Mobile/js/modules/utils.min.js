define(function(require,exports,module){var _requesting=false;var _timers={};exports.on_orientation_change=function(){var landscapeWrap=document.getElementsByClassName("landscape")[0];window.addEventListener("orientationchange",doOnOrientationChange);doOnOrientationChange();function doOnOrientationChange(){switch(window.orientation){case -90:case 90:landscapeWrap.style.display="block";break;default:landscapeWrap.style.display="none";break}}};exports.get_token=function(){return $("#csrf_div").find("input").val()};exports.get_random_str=function(len,type){var chars=[],i,max,min,ret=[];if(type=="numeric"){chars=["0","1","2","3","4","5","6","7","8","9"]}else{if(type=="alpha"){chars=["a","b","c","d","e","g","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"]}else{chars=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","g","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"]}}max=chars.length;min=0;for(i=0;i<len;i++){rand=Math.floor(Math.random()*(max-min)+min);ret.push(chars[rand])}return ret.join("")};exports.param_check=function(value,type){if(!value||!type){return false}var p="";if(type=="alpha"){p=/^[a-z]+$/i}else{if(type=="alpha_numeric"){p=/^[a-z0-9]+$/i}else{if(type=="alpha_numeric_spaces"){p=/^[a-z0-9\s]+$/i}else{if(type=="alpha_dash"){p=/^[a-z0-9_-]+$/i}else{if(type=="alpha_zh_spaces"){p=/^[\x7f-\xffa-z0-9\s]+$/i}else{if(type=="numeric"){p=/^[0-9]+$/i}else{if(type=="valid_url"){p=/\b(?:(?:https?|ftp):\/\/|www\.)[-a-z0-9+&@#\/%?=~_|!:,.;]*[-a-z0-9+&@#\/%=~_|]/i}else{if(type=="valid_email"){p=/([\w\-]+\@[\w\-]+\.[\w\-]+)/}else{if(type=="valid_mobile"){p=/^[0-9]+$/i}else{return false}}}}}}}}}return p.test(value)};exports.input_bind=function(id,name,minlen,maxlen,type,get_error_dom){$("#"+id).blur(function(){var value=$.trim($(this).val()),len=value.length,error=$(this).parent().parent().find(".formtips-error");if(typeof get_error_dom==="function"){error=get_error_dom($(this))}if(!value){return false}if(len<minlen){$(this).addClass("inputtips-error");error.html(name+"不能少于"+minlen+"个字符").css("display","block");return false}if(len>maxlen){$(this).addClass("inputtips-error");error.html(name+"不能大于"+maxlen+"个字符").css("display","block");return false}if(type){if(!module.exports.param_check(value,type)){$(this).addClass("inputtips-error");error.html(name+"格式错误，请重新输入").css("display","block");return false}}return true});$("#"+id).focus(function(event){var error=$(this).parent().parent().find(".formtips-error");if(typeof get_error_dom==="function"){error=get_error_dom($(this))}error.hide();$(this).removeClass("inputtips-error")})};exports.form_check=function(errordom,obj){var i,id="",name="",key="",value="",etype="",dtype="",edom={},minlen=0,maxlen=0,required=true,data={};for(i in obj){id=obj[i]["id"];name=obj[i]["name"];key=typeof obj[i]["key"]!=="undefined"?obj[i]["key"]:id;etype=obj[i]["etype"];dtype=typeof obj[i]["dtype"]!=="undefined"?obj[i]["dtype"]:"";edom=typeof obj[i]["errordom"]!=="undefined"?obj[i]["errordom"]:null;minlen=typeof obj[i]["minlen"]!=="undefined"?obj[i]["minlen"]:0;maxlen=typeof obj[i]["maxlen"]!=="undefined"?obj[i]["maxlen"]:0;required=typeof obj[i]["required"]!=="undefined"?obj[i]["required"]:false;if(!id||!name||!etype){throw ("配置错误");return false}if(etype=="input_text"||etype=="select"){value=$.trim($("#"+id).val())}if(!value&&required){module.exports.show_error_tip("请输入"+name,"form_check",errordom);return false}if(value.length<minlen&&!(!required&&value.length==0)){module.exports.show_error_tip(name+"的长度不能小于"+minlen+"个字符","form_check",errordom);return false}if(value.length>maxlen){module.exports.show_error_tip(name+"的长度不能超过"+maxlen+"个字符","form_check",errordom);return false}if(dtype&&!(!required&&value.length==0)){if(!module.exports.param_check(value,dtype)){module.exports.show_error_tip(name+"格式错误，请重新输入","form_check",errordom);return false}}data[key]=value}return data};exports.confirm=function(title,msg,confirm_func,cancel_func,close_func){if(typeof arguments[0]==="object"){var obj=arguments[0],title=typeof obj["title"]!=="undefined"?obj["title"]:"",msg=typeof obj["msg"]!=="undefined"?obj["msg"]:"",confirm_text=typeof obj["confirm_text"]!=="undefined"?obj["confirm_text"]:"确定",cancel_text=typeof obj["cancel_text"]!=="undefined"?obj["cancel_text"]:"取消",confirm_func=typeof obj["confirm_func"]!=="undefined"?obj["confirm_func"]:null,cancel_func=typeof obj["cancel_func"]!=="undefined"?obj["cancel_func"]:null,close_func=typeof obj["close_func"]!=="undefined"?obj["close_func"]:null;$("#base-confirm .mod-btn-blue").text(confirm_text);$("#base-confirm .mod-btn-black").text(cancel_text)}$("#base-confirm").addClass("mod-popup-show");$("#base-confirm .content_title").text(title);$("#base-confirm .content_text").html(msg);$("#base-confirm .mod-btn-blue").unbind("click");$("#base-confirm .mod-btn-black").unbind("click");$("#base-confirm .i-close").unbind("click");$("#base-confirm .popup_mask").unbind("click");$("#base-confirm .mod-btn-blue").click(function(){$("#base-confirm").removeClass("mod-popup-show");
if(typeof confirm_func==="function"){confirm_func()}});$("#base-confirm .mod-btn-black").click(function(){$("#base-confirm").removeClass("mod-popup-show");if(typeof cancel_func==="function"){cancel_func()}});$("#base-confirm .i-close").click(function(){$("#base-confirm").removeClass("mod-popup-show");if(typeof close_func==="function"){close_func()}});$("#base-confirm .popup_mask").click(function(){$("#base-confirm").hide();if(typeof close_func==="function"){close_func()}})};exports.alert=function(msg,type,close_func){type=typeof type!=="number"?0:type;if(type==1){$("#base-alert").attr("class","mod-popup mod-popup-success");$("#base-alert .content_pic").show()}else{if(type==-1){$("#base-alert").attr("class","mod-popup mod-popup-fail");$("#base-alert .content_pic").show()}else{$("#base-alert").attr("class","mod-popup mod-popup-alert");$("#base-alert .content_pic").hide()}}$("#base-alert .content_text").text(msg);$("#base-alert .i-close").unbind("click");$("#base-alert .popup_mask").unbind("click");$("#base-alert .i-close").click(function(){hide();if(typeof close_func==="function"){close_func()}});$("#base-alert .popup_mask").click(function(){hide();if(typeof close_func==="function"){close_func()}});show();function show(){$("#base-alert").addClass("mod-popup-show")}function hide(){$("#base-alert").removeClass("mod-popup-show")}};exports.modified_box_bind=function(input_id,plus_id,minus_id,max_num,min_num,onchange){max_num=max_num?max_num:99;min_num=min_num?min_num:1;$("#"+plus_id).click(function(){var num=parseInt($.trim($("#"+input_id).val()));if(num>=max_num){return}num++;$("#"+input_id).val(num);if(typeof onchange==="function"){onchange(num)}});$("#"+minus_id).click(function(){var num=parseInt($.trim($("#"+input_id).val()));if(num<=min_num){return}num--;$("#"+input_id).val(num);if(typeof onchange==="function"){onchange(num)}});$("#"+input_id).keyup(function(event){var num=parseInt($.trim($("#"+input_id).val()));num=num?num:0;if(typeof onchange==="function"){onchange(num)}})};exports.search_box_bind=function(input_id,btn_id,url,maxlen){$("#"+input_id).keyup(function(event){if(event.keyCode==13){handle(url)}});if(btn_id){$("#"+btn_id).click(function(){handle(url)})}function handle(url){var value=$.trim($("#"+input_id).val()),len=value.length,url=url.replace("{keyword}",value);maxlen=maxlen?maxlen:20;if(len>maxlen){module.exports.alert("搜索关键词不能超过"+maxlen+"个字符哦",-1);return}location.href=url}};exports.radio_bind=function(radio_id){$("#"+radio_id+" .label_radio").click(function(){var classname=$(this).attr("class");if(classname.indexOf("unchecked")>=0){$("#"+radio_id+" .label_radio").attr("class","label_radio unchecked");$(this).attr("class","label_radio checked")}})};exports.radio_value=function(radio_id){return $("#"+radio_id+" .checked").attr("value")};exports.logout_bind=function(id){$("#"+id).on("click",function(){module.exports.post("index.php/login/out",{action:"logout"},function(json){if(json.ret==0){location.reload()}else{module.exports.alert(json.msg,-1)}})})};exports.login_check=function(callback){module.exports.get("index.php/login/check",function(json){var haslogin=json.ret==0?true:false;if(typeof callback==="function"){callback(haslogin)}})};exports.post=function(url,data,successfunc,completefunc){if(_requesting){return}data["csrf_token"]=module.exports.get_token();_requesting=true;$.ajax({type:"POST",url:url,data:data,timeout:10000,dataType:"json",error:function(xhr,textStatus){if(textStatus=="timeout"){module.exports.alert("当前网络环境较差，建议您刷新页面后重试",-1)}else{module.exports.alert("服务请求异常，请重试",-1)}},success:function(json,textStatus){if(typeof successfunc==="function"){successfunc(json)}},complete:function(xhr,textStatus){_requesting=false;if(typeof completefunc==="function"){completefunc()}}})};exports.get=function(url,successfunc,completefunc){var random=module.exports.get_random_str(16);url+=url.indexOf("?")>0?"&t="+random:"?t="+random;$.ajax({type:"GET",url:url,timeout:10000,dataType:"json",error:function(xhr,textStatus){if(textStatus=="timeout"){module.exports.alert("当前网络环境较慢，建议您刷新页面后重试",-1)}else{module.exports.alert("服务器请求异常",-1)}},success:function(json,textStatus){if(typeof successfunc==="function"){successfunc(json)}},complete:function(xhr,textStatus){_requesting=false;if(typeof completefunc==="function"){completefunc()}}})};exports.show_error_tip=function(msg,id,dom){if(_timers.hasOwnProperty(id)&&_timers[id]){clearTimeout(_timers[id])}if(typeof dom!=="object"){dom=$("#"+id)}dom.text(msg).show();dom.css("display","block");_timers[id]=setTimeout(function(){dom.hide()},5000)};exports.show_login_box=function(msg){show();if(msg){$("#base-login-box .content_text").text(msg)}$("#base-login-box .i-close").unbind("click");$("#base-login-box .popup_mask").unbind("click");$("#base-login-box .i-close").click(function(){hide()});function show(){$("#base-login-box").addClass("mod-popup-show")}function hide(){$("#base-login-box").removeClass("mod-popup-show")}};exports.set_time_select=function(yeardom,monthdom,daydom,startyear){var dateobj=new Date(),year=dateobj.getFullYear(),month=dateobj.getMonth()+1,day=dateobj.getDate(),start=0,end=0;
start=startyear?startyear:2012;end=year;yeardom.html(getHTML("year",start,end,"desc"));monthdom.html(getHTML("month",1,12,month));start=1;end=new Date(year,month,0).getDate();daydom.html(getHTML("day",start,end,day));monthdom.on("change",function(){var year=yeardom.val(),month=monthdom.val(),start=1,end=new Date(year,month,0).getDate();daydom.html(getHTML("day",start,end,"asc"))});yeardom.on("change",function(){var year=yeardom.val(),month=monthdom.val(),start=1,end=new Date(year,month,0).getDate();daydom.html(getHTML("day",start,end,"asc"))});function getHTML(type,start,end,order){var i,ary=[],str="",typestr="";if(type=="year"){typestr="年"}else{if(type=="month"){typestr="月"}else{typestr="日"}}if(!order){order="desc"}if(order=="desc"){ary.push('<option value="'+0+'">'+typestr+"</option>");for(i=end;i>=start;i--){str=i.toString();str=str.length==1?"0"+str:str;ary.push('<option value="'+i+'">'+str+typestr+"</option>")}}else{ary.push('<option value="'+0+'">'+typestr+"</option>");for(i=start;i<=end;i++){str=i.toString();str=str.length==1?"0"+str:str;ary.push('<option value="'+i+'">'+str+typestr+"</option>")}}return ary.join("")}};exports.set_pagination=function(id){var dom=$("#"+id);if($.trim(dom.text())==""){return false}var html="",cur_page=dom.find(".pageflip_pagenum-active"),next_page=dom.find(".pc-pagination-next"),prev_page=dom.find(".pc-pagination-prev"),first_page=dom.find(".pc-pagination-first"),last_page=dom.find(".pc-pagination-last"),cur_num=cur_page.text(),next_link=next_page.find("a").attr("href"),prev_link=prev_page.find("a").attr("href"),first_link=first_page.find("a").attr("href"),last_link=last_page.find("a").attr("href");if(!prev_link&&next_link){html='<div class="mod-pageflip mod-pageflip-r"><a class="i-arrow-right" href="'+next_link+'"></a><span>首页</span></div>';dom.after(html);return true}if(prev_link&&!next_link&&!first_link){html='<div class="mod-pageflip mod-pageflip-rll"><a class="i-arrow-left" href="'+prev_link+'"></a><span>尾页</span></div>';dom.after(html);return true}if(prev_link&&next_link&&!first_link){html='<div class="mod-pageflip mod-pageflip-rl"><a class="i-arrow-left" href="'+prev_link+'"></a><a class="i-arrow-right" href="'+next_link+'"></a><span>第 '+cur_num+" 页</span></div>";dom.after(html);return true}if(prev_link&&next_link&&first_link){html='<div class="mod-pageflip mod-pageflip-rll"><a class="i-arrow-left-d" href="'+first_link+'"></a><a class="i-arrow-left" href="'+prev_link+'"></a><a class="i-arrow-right" href="'+next_link+'"></a><span>第 '+cur_num+" 页</span></div>";dom.after(html);return true}if(prev_link&&!next_link&&first_link){html='<div class="mod-pageflip mod-pageflip-rll"><a class="i-arrow-left-d" href="'+first_link+'"></a><a class="i-arrow-left" href="'+prev_link+'"></a><span>尾页</span></div>';dom.after(html);return true}};exports.iswechat=function(){var ua=navigator.userAgent.toLowerCase();if(ua.match(/MicroMessenger/i)=="micromessenger"){return true}else{return false}};exports.auto_img=function(){var imglist=document.getElementsByTagName("img");var _width;do_draw();window.onresize=function(){do_draw()};function do_draw(){_width=window.innerWidth;for(var i=0,len=imglist.length;i<len;i++){draw_img(imglist[i],_width)}}function draw_img(img,_width){var image=new Image();image.src=img.src;image.onload=function(){if(image.width>30&&image.height>30){if(image.width>_width){img.width=_width;img.height=(image.height*_width)/image.width}else{img.width=image.width;img.height=image.height}}}}};exports.set_wechat_share=function(imgurl){if(!module.exports.iswechat()){return}imgurl=imgurl?imgurl:module.exports.base_url()+"/static/v2.0/mobile/images/wechat-share.png";document.addEventListener("WeixinJSBridgeReady",function onBridgeReady(){WeixinJSBridge.on("menu:share:appmessage",function(){WeixinJSBridge.invoke("sendAppMessage",{"appid":"","img_url":imgurl,"img_width":"120","img_height":"120","link":document.href,"title":document.title},function(res){});return false});WeixinJSBridge.on("menu:share:timeline",function(){WeixinJSBridge.invoke("shareTimeline",{"appid":"","img_url":imgurl,"img_width":"120","img_height":"120","link":document.href,"title":document.title},function(res){});return false})},false)};exports.code_break_word=function(id){var cssdata={"word-wrap":"break-word","white-space":"pre-wrap"};$("#"+id).css(cssdata);$("#"+id).find("code").css(cssdata);$("#"+id).find("pre").css(cssdata)};exports.base_url=function(){return location.protocol+"//"+location.host};window.shareto=function(type){if(type=="qqwb"){var _t=encodeURI(document.title);var _url=encodeURI(window.location);var _source=1000000;var _site=encodeURI(module.exports.base_url());var _pic="";var _u="http://v.t.qq.com/share/share.php?title="+_t+"&url="+_url+"&source="+_source+"&site="+_site+"&pic="+_pic;window.open(_u,"转播到腾讯微博","width=700, height=480, top=320, left=180, toolbar=no, menubar=no, scrollbars=no, location=yes, resizable=no, status=no");return}if(type=="sinawb"){(function(s,d,e){try{}catch(e){}var f="http://v.t.sina.com.cn/share/share.php?",u=d.location.href,p=["url=",e(u),"&title=",e(d.title),"&appkey="].join("");
function a(){if(!window.open([f,p].join(""),"mb",["toolbar=0,status=0,resizable=1,width=620,height=450,left=",(s.width-620)/2,",top=",(s.height-450)/2].join(""))){u.href=[f,p].join("")}}if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent);return}}});